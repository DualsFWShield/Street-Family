<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Street Family Manager</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Gestion des inscriptions Street Family - Optimis√© et Design">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-area">
                <img src="assets/logo.png" alt="Logo" style="height: 40px; border-radius: 8px;">
                <h1>SF Manager</h1>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <span class="stat-title">Membres</span>
                    <span class="stat-value" id="totalMembers">--</span>
                </div>
                <div class="stat-card highlight">
                    <span class="stat-title">Actifs</span>
                    <span class="stat-value" id="activeMembers">--</span>
                </div>
            </div>

            <nav class="filters-nav">
                <h3>Filtres</h3>
                <div class="filter-group">
                    <label>Statut Paiement</label>
                    <select id="filterPayment">
                        <option value="all">Tous</option>
                        <option value="paid">Pay√©s</option>
                        <option value="partial">A moiti√© pay√©s</option>
                        <option value="unpaid">Non Pay√©s</option>
                        <option value="na">N/A</option>
                    </select>
                </div>
            </nav>

            <div class="actions-area">
                <button id="settingsBtn" class="btn btn-secondary">
                    <i class="fa-solid fa-table-columns"></i> Colonnes
                </button>
                <button id="tarifsBtn" class="btn btn-secondary" style="margin-top: 0.5rem;">
                    <i class="fa-solid fa-tags"></i> Voir Tarifs
                </button>
                <button id="exportBtn" class="btn btn-primary" style="margin-top: 1rem;">
                    <i class="fa-solid fa-file-export"></i> Exporter Excel
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="search-wrapper">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="searchInput" placeholder="Rechercher (Nom, Cours)...">
                </div>
                <div class="file-status">
                    <input type="file" id="fileInput" accept=".xlsx, .xls" class="hidden-input">
                    <label for="fileInput" class="btn btn-secondary">
                        <i class="fa-solid fa-upload"></i> Charger Fichier
                    </label>
                </div>
            </header>

            <div class="content-area">
                <!-- Drop Zone (Initial State) -->
                <div id="dropZone" class="drop-zone">
                    <div class="drop-content">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <h2>Glisser-d√©poser le fichier Inscriptions ici</h2>
                        <p>ou cliquez sur charger fichier</p>
                    </div>
                </div>

                <!-- Data Table (Hidden initially) -->
                <div id="tableContainer" class="table-container hidden">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <!-- Injected by JS -->
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Modifier Membre</h2>
                <button class="close-modal"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editId">

                    <div class="form-section-title">Informations G√©n√©rales</div>
                    <div class="grid-2">
                        <div class="form-group span-2">
                            <label>Nom et Pr√©nom</label>
                            <input type="text" id="editName" required>
                        </div>
                        <div class="form-group checkbox-group">
                            <label for="editActive" style="margin-bottom:0">Fiche Rentr√©e</label>
                            <input type="checkbox" id="editActive" style="width: 20px; height: 20px;">
                        </div>
                        <div class="form-group">
                            <label>Sexe</label>
                            <select id="editSex">
                                <option value=""></option>
                                <option value="F">F</option>
                                <option value="M">M</option>
                                <option value="X">X</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section-title">Cours & Tarifs</div>
                    <div class="form-group">
                        <label>Cours</label>
                        <input type="text" id="editCourses">
                    </div>
                    <div class="grid-3">
                        <div class="form-group">
                            <label>Nb Heures</label>
                            <input type="text" id="editNbHours">
                        </div>
                        <div class="form-group">
                            <label>R√©duction</label>
                            <input type="text" id="editReduction">
                        </div>
                        <div class="form-group">
                            <label>Total √† Payer (‚Ç¨)</label>
                            <input type="number" step="0.01" id="editAmountDue">
                        </div>
                    </div>

                    <div class="form-section-title">Paiements</div>
                    <div class="form-group">
                        <label>Type Paiement</label>
                        <select id="editPaymentType">
                            <option value="Par ann√©e">Par ann√©e</option>
                            <option value="Par semestre">Par semestre</option>
                        </select>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Paiement 1 (‚Ç¨)</label>
                            <input type="number" step="0.01" id="editPaid1">
                        </div>
                        <div class="form-group">
                            <label>En date du (1)</label>
                            <input type="text" id="editDate1" placeholder="DD-MM-YYYY">
                        </div>
                        <div class="form-group">
                            <label>Paiement 2 (‚Ç¨)</label>
                            <input type="number" step="0.01" id="editPaid2">
                        </div>
                        <div class="form-group">
                            <label>En date du (2)</label>
                            <input type="text" id="editDate2" placeholder="DD-MM-YYYY">
                        </div>
                    </div>

                    <div class="form-section-title">Coordonn√©es</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>T√©l √âl√®ve</label>
                            <input type="text" id="editTelStudent">
                        </div>
                        <div class="form-group">
                            <label>T√©l Parents</label>
                            <input type="text" id="editTelParents">
                        </div>
                        <div class="form-group">
                            <label>Email √âl√®ve</label>
                            <input type="text" id="editMailStudent">
                        </div>
                        <div class="form-group">
                            <label>Email Parents</label>
                            <input type="text" id="editMailParents">
                        </div>
                        <div class="form-group span-2">
                            <label>Nom Responsable</label>
                            <input type="text" id="editParentsName">
                        </div>
                    </div>

                    <div class="form-section-title">Adresse & Divers</div>
                    <div class="form-group">
                        <label>Adresse</label>
                        <input type="text" id="editAddress">
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>CP</label>
                            <input type="text" id="editCP">
                        </div>
                        <div class="form-group">
                            <label>Ville</label>
                            <input type="text" id="editCity">
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Date Naissance</label>
                            <input type="text" id="editDOB" placeholder="DD-MM-YYYY">
                        </div>
                        <div class="form-group">
                            <label>Lieu Naissance</label>
                            <input type="text" id="editPOB">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Autre (Sant√© etc)</label>
                        <input type="text" id="editOther">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal-btn">Annuler</button>
                <button type="submit" form="editForm" class="btn btn-primary">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Affichage des Colonnes</h2>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-muted); margin-bottom:1rem;">Cochez les colonnes √† afficher :</p>
                <div id="settingsColumnsList" class="settings-list">
                    <!-- Checkboxes injected by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveSettingsBtn">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Tarifs Modal -->
    <div id="tarifsModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Grille des Tarifs</h2>
                <button class="close-modal"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <div style="overflow-x:auto;">
                    <table class="data-table" id="tarifsTable">
                        <thead>
                            <tr>
                                <th>Heures</th>
                                <th>Semestre</th>
                                <th>Ann√©e</th>
                                <th>-10% Sem</th>
                                <th>-10% Ann√©e</th>
                                <th>-15% Sem</th>
                                <th>-15% Ann√©e</th>
                                <th>Famille Sem</th>
                                <th>Famille Ann√©e</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary close-modal-btn">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Libraries (CDN) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="modal-overlay hidden">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h2>Envoyer un Rappel üí¨</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Style du message</label>
                    <div class="style-selector">
                        <button class="style-btn active" onclick="selectStyle(this, 'casual')">D√©contract√©</button>
                        <button class="style-btn" onclick="selectStyle(this, 'formal')">Formel</button>
                        <button class="style-btn" onclick="selectStyle(this, 'urgent')">Urgent</button>
                        <button class="style-btn" onclick="selectStyle(this, 'fun')">Fun</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Aper√ßu du message</label>
                    <textarea id="reminderPreview" class="preview-box" rows="6"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="reminderManager.closeModal()">Annuler</button>
                <button id="copyReminderBtn" class="btn btn-primary" onclick="window.reminderManager.copyToClipboard()">
                    <i class="fa-regular fa-copy"></i> Copier
                </button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="exportModal" class="modal-overlay hidden">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h2>Options d'Export üì•</h2>
            </div>
            <div class="modal-body">
                <div class="export-section">
                    <label class="custom-checkbox">
                        <input type="checkbox" id="exportFormattedPhone" checked>
                        Standardiser les num√©ros de t√©l√©phone (+32...)
                    </label>
                </div>

                <div class="export-section">
                    <div class="section-title">Colonnes Suppl√©mentaires</div>
                    <div class="checkbox-stack">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="exportColStatus" checked>
                            Statut (Pay√©/Non Pay√©)
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="exportColBalance" checked>
                            Solde Restant (‚Ç¨)
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.app.uiManager.closeExportModal()">Annuler</button>
                <button class="btn btn-primary" onclick="window.app.processExport()">
                    <i class="fa-solid fa-file-export"></i> Exporter
                </button>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script src="js/reminder.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Helper for style buttons
        function selectStyle(btn, style) {
            document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            window.reminderManager.updatePreview(style);
        }
    </script>
</body>

</html>